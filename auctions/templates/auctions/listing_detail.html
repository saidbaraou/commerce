{% extends "auctions/layout.html" %}

<style>
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  input[type="number"] {
    appearance: textfield;
    -moz-appearance: textfield;
  }
</style>

{% block body %}

<div class="d-flex justify-content-center align-items-center">
  <div class="p-3 d-flex flex-column">

    {% if listing.image_url %}
    <img class="card-img-top" src="{{ listing.image_url }}" alt="{{listing.title}}" width="200" height="400">
    {% else %}
    <img
      src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse4.mm.bing.net%2Fth%3Fid%3DOIP.Pneh22uyXw_rJ8leBae8VwHaHa%26pid%3DApi&f=1&ipt=10c45487fc9f75a21350c49ed1a2afbb06a8c4f4ee6e45cec979419944b77f4f&ipo=images"
      class="card-img-top" alt="no image available">
    {% endif %}

    <h2 class="mt-2">{{ listing.title }}</h2>

    <h3 class="mb-2 text-decoration-line-through">${{ listing.price }}</h3>
    {% if listing.current_bid %}
    <h3 class="mb-2">${{ listing.current_bid }}</h3>
    {% if request.user == user %}
    <p class="text-secondary">Current bid was placed by you
      {% else %}
    <p class="text-secondary">Current bid was placed by {{ user }}
      {% endif %}
      {% else %}
    <h3 class="mb-2">${{ listing.price }}</h3>

    </p>
    {% endif %}
    <p class="text-secondary">Listed by {{ listing.created_by }} -
      On {{ listing.created_at }}


      {% if user.is_authenticated %}

      {% if is_in_watchlist %}

    <form method="POST" action="{% url 'remove_watchlist' listing_id=listing.id %}">

      {% csrf_token %}
      <div class="d-grid">
        <button type="submit" class="btn btn-outline-danger mt-2">Remove from watchlist</button>
      </div>
    </form>
    {% else %}
    <form method="POST" action="{% url 'add_watchlist' listing_id=listing.id %}">

      {% csrf_token %}
      <div class="d-grid">
        <button type=" submit" class="btn btn-outline-success mt-2">Add to watchlist</button>
      </div>
    </form>
    {% endif %}

    {% endif %}

    <hr>
    <h5>Description</h5>
    <p>{{ listing.description }} </p>

    <!-- This condition here to render the bid form only if the user is not the one who created the listing -->
    {% if user.is_authenticated and user != listing.created_by %}
    <hr>
    <h5>Bid</h5>
    <form method="POST" action="{% url 'place_bid' listing_id=listing.id %}">
      {% csrf_token %}
      <div>
        {{ form.as_p }}
      </div>

      {% if form.errors or form.non_field_errors %}
      <div class="invalid-feedback">
        {% for field in form %}
        {{ field.errors }}
        {% endfor %}

        {{ form.non_field_errors }}
      </div>
      {% endif %}

      <button type="submit" class="btn btn-primary">Place Bid</button>
    </form>
    {% endif %}


    {% endblock %}